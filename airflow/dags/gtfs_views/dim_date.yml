operator: operators.SqlToWarehouseOperator
dst_table_name: "views.dim_date"

sql: |
  # from https://gist.github.com/ewhauser/d7dd635ad2d4b20331c7f18038f04817
  SELECT
    FORMAT_DATE('%F', d) as id,
    d AS full_date,
    EXTRACT(YEAR FROM d) AS year,
    EXTRACT(WEEK FROM d) AS year_week,
    EXTRACT(DAY FROM d) AS year_day,
    EXTRACT(YEAR FROM d) AS fiscal_year,
    FORMAT_DATE('%Q', d) as fiscal_qtr,
    EXTRACT(MONTH FROM d) AS month,
    FORMAT_DATE('%B', d) as month_name,
    FORMAT_DATE('%w', d) AS week_day,
    FORMAT_DATE('%A', d) AS day_name,
    (CASE WHEN FORMAT_DATE('%A', d) IN ('Sunday', 'Saturday') THEN 0 ELSE 1 END) AS day_is_weekday,
    DATETIME_TRUNC(d, DAY) = DATETIME_TRUNC(d, QUARTER) AS is_quarter_start,
    d < CURRENT_DATE() AS is_in_past,
    d <= CURRENT_DATE() AS is_in_past_or_present,
    d > CURRENT_DATE() AS is_in_future
  FROM (
    SELECT
      *
    FROM
      UNNEST(GENERATE_DATE_ARRAY('2021-01-01', '2031-01-01', INTERVAL 1 DAY)) AS d )
