
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>RT Analysis Module (Legacy) &#8212; Cal-ITP Data Services</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1d5f98c3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-SZB618VNBZ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-SZB618VNBZ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-SZB618VNBZ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'analytics_tools/rt_analysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Saving Code" href="saving_code.html" />
    <link rel="prev" title="Scripts" href="scripts.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/calitp_logo_MAIN.png" class="logo__image only-light" alt="Cal-ITP Data Services - Home"/>
    <script>document.write(`<img src="../_static/calitp_logo_MAIN.png" class="logo__image only-dark" alt="Cal-ITP Data Services - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Data Services Documentation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Analysts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../analytics_welcome/overview.html">Welcome!</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analytics_welcome/what_is_calitp.html">Cal-ITP Project Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_welcome/how_we_work.html">How We Work</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../analytics_onboarding/overview.html">Technical Onboarding</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="overview.html">Introduction to Analytics Tools</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="github_setup.html">GitHub Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools_quick_links.html">Tools Quick Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="bi_dashboards.html">Business Insights &amp; Dashboards</a></li>
<li class="toctree-l2"><a class="reference internal" href="jupyterhub.html">JupyterHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="local_oracle_db_connections.html">Local Oracle Database Connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_libraries.html">Useful Python Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">RT Analysis Module (Legacy)</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving_code.html">Saving Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="storing_data.html">Storing Data During Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_catalogs.html">Using Data Catalogs</a></li>

<li class="toctree-l2"><a class="reference internal" href="knowledge_sharing.html">Helpful Links</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../analytics_new_analysts/overview.html">Tutorials for New Python Users</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/01-data-analysis-intro.html">Data Analysis: Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/02-data-analysis-intermediate.html">Data Analysis: Intermediate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/03-data-management.html">Data Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/04-notebooks.html">Working with Jupyter notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/05-spatial-analysis-basics.html">Working with Geospatial Data: Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/06-spatial-analysis-intro.html">Working with Geospatial Data: Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/07-spatial-analysis-intermediate.html">Working with Geospatial Data: Intermediate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../analytics_new_analysts/08-spatial-analysis-advanced.html">Working with Geospatial Data: Advanced</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../warehouse/overview.html">Introduction to the Warehouse</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/warehouse_starter_kit.html">Warehouse: Where to Begin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/navigating_dbt_docs.html">Navigating the dbt Docs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/what_is_agency.html">What is an <code class="docutils literal notranslate"><span class="pre">agency</span></code>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/developing_dbt_models.html">Developing models in dbt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/adding_oneoff_data.html">Adding Ad-Hoc Data to the Warehouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../warehouse/what_is_gtfs.html">What is GTFS, anyway?</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../publishing/overview.html">Where can I publish data?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/1_publishing_principles.html">Data Publishing Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/2_static_files.html">Static Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/3_github_pages.html">HTML Visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/4_notebooks_styling.html">Getting Notebooks Ready for the Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/5_analytics_portfolio_site.html">The Cal-ITP Analytics Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/6_metabase.html">Metabase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/7_gcs.html">GCS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/8_ckan.html">Publishing data to California Open Data aka CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../publishing/sections/9_geoportal.html">Publishing data to California State Geoportal</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../architecture/architecture_overview.html">Architecture Overview</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../architecture/services.html">Deployed Services and Sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/images_and_packages.html">Published Images and Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/data.html">Data pipelines</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../airflow/dags-maintenance.html">Airflow Operational Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transit_database/transitdatabase.html">Transit Database (Airtable)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contribute to the Docs!</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../contribute/overview.html">Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/contribute-best-practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/submitting_changes.html">Submitting Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/content_types.html">Common Content</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cal-itp/data-infra" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cal-itp/data-infra/edit/main/docs/analytics_tools/rt_analysis.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cal-itp/data-infra/issues/new?title=Issue%20on%20page%20%2Fanalytics_tools/rt_analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/analytics_tools/rt_analysis.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>RT Analysis Module (Legacy)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rt-filter-map-plot-your-flexible-analytics-and-mapping-interface"><code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot</span></code>: your flexible analytics and mapping interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-intermediate-data-largely-automatically">Loading Intermediate Data (largely automatically)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering">Filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping">Mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-performant-maps-via-embedded-app">More performant maps via embedded app</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-segment-speed-view"><code class="docutils literal notranslate"><span class="pre">stop_segment_speed_view</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-charts-and-metrics">Other Charts and Metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corridor-analysis">Corridor Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow-california-transit-speed-maps">Example Workflow: California Transit Speed Maps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow-sccp">Example Workflow: SCCP</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="rt-analysis-module-legacy">
<h1>RT Analysis Module (Legacy)<a class="headerlink" href="#rt-analysis-module-legacy" title="Link to this heading">#</a></h1>
<p>The former <code class="docutils literal notranslate"><span class="pre">rt_parser</span></code> module, including the <code class="docutils literal notranslate"><span class="pre">OperatorDayAnalysis</span></code> and <code class="docutils literal notranslate"><span class="pre">VehiclePositionsInterpolator</span></code> classes, has been deprecated. A truncated version of these docs remains as a guide to accessing processed speeds outputs that predate the <code class="docutils literal notranslate"><span class="pre">rt_segment_speeds</span></code> pipeline. <code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot</span></code> is still usable as of June 2025, or artifacts on GCS can be accessed directly.</p>
<section id="rt-filter-map-plot-your-flexible-analytics-and-mapping-interface">
<h2><code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot</span></code>: your flexible analytics and mapping interface<a class="headerlink" href="#rt-filter-map-plot-your-flexible-analytics-and-mapping-interface" title="Link to this heading">#</a></h2>
<div class="mermaid">
            flowchart TD
    gcs[(&quot;GCS (calitp-analytics-data/data_analyses/rt_delay)&quot;)]
    map_gcs[(&quot;Public GCS (calitp-map-tiles/)&quot;)]
    subgraph rt_fil_map[RtFilterMapper]
        st_flt[self.set_filter] --&gt;
        flt[self._filter]
        rs_flt[self.reset_filter] --&gt;
        flt
        subgraph stv[static views]
            self.organization_name
            self.rt_trips
            self.stop_delay_view
            self.endpoint_delay_summary
            self.endpoint_delay_view
        end
        subgraph dyn[dynamic tools]
            ssm[self.segment_speed_map] --&gt;|optionally renders map| dmv
            dmv[self.detailed_map_view] --&gt;
            gis[/Manual GIS Format Exports/]
            dmv --&gt; mgz[self.map_gz_export]
            self.chart_variability
            mpv[self.map_variance]
            mpv --&gt; |optionally renders map| mgz
            mgz -.-&gt; map_gcs
            map_gcs -.-&gt; spa
            mgz -.-&gt; |self.spa_map_state| spa
            mgz --&gt;|self.display_spa_map| spa([render maps via external app + IFrame])
            self.chart_delays
            self.chart_speeds
            self.describe_slow_routes
            ssm --&gt; ssv[self.stop_segment_speed_view]
            subgraph cor[corridor tools]
                acor[self.autocorridor] -.-&gt;
                add_cor[self.add_corridor] --&gt;
                qmc[self.quick_map_corridor]
                c_met[self.corridor_metrics]
                add_cor --&gt; c_met
                ext[/external corridor/] -.-&gt; add_cor
            end
            ssv -.-&gt; acor
        end
        %% add_cor -.-&gt;|corridor= True| ssm
        flt --&gt; dyn
        stv --&gt; dyn
    end
    %% top level links
    gcs --&gt;|rt_trips| fm_gcs
    gcs --&gt;|stop_delay_view| fm_gcs
    fm_gcs[rt_filter_map_plot.from_gcs] --&gt; rt_fil_map
    rt_fil_map --&gt; speedmaps[/CA Transit Speed Maps/]
    rt_fil_map --&gt; bb[/Better Buses Analysis/]
    rt_fil_map --&gt; sccp[/SCCP/LPP Transit Delay/]
    rt_fil_map --&gt; other[/Other Exposures/]
        </div><p><code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot</span></code> exists to provide robust analytics functionality separately from the compute-intensive raw data processing steps. It includes the RtFilterMapper class, which provides an interface for loading and filtering a day of data, plus tools to generate various maps, charts, and metrics.</p>
<p><em>Check out the <a class="reference external" href="https://github.com/cal-itp/data-analyses/blob/main/rt_delay/31_tutorial.ipynb">walkthrough notebook</a> for further explanation/demo of these steps</em></p>
<section id="loading-intermediate-data-largely-automatically">
<h3>Loading Intermediate Data (largely automatically)<a class="headerlink" href="#loading-intermediate-data-largely-automatically" title="Link to this heading">#</a></h3>
<p>To load intermediate data, use <code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot.from_gcs</span></code> to create an RtFilterMapper instance for the itp_id and date of interest.</p>
</section>
<section id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Link to this heading">#</a></h3>
<p>Using the <code class="docutils literal notranslate"><span class="pre">set_filter</span></code> method, RtFilterMapper supports filtering based on at least one of these attributes at a time:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Attribute</p></td>
<td><p>Type</p></td>
</tr>
<tr class="row-odd"><td><p>start_time</p></td>
<td><p>str (%H:%M, i.e. 11:00)</p></td>
</tr>
<tr class="row-even"><td><p>end_time</p></td>
<td><p>str (%H:%M, i.e. 19:00)</p></td>
</tr>
<tr class="row-odd"><td><p>route_names</p></td>
<td><p>list, pd.Series</p></td>
</tr>
<tr class="row-even"><td><p>shape_ids</p></td>
<td><p>list, pd.Series</p></td>
</tr>
<tr class="row-odd"><td><p>direction_id</p></td>
<td><p>str, ‘0’ or ‘1’</p></td>
</tr>
<tr class="row-even"><td><p>direction</p></td>
<td><p>str, “Northbound”, etc, <em>experimental</em></p></td>
</tr>
<tr class="row-odd"><td><p>trip_ids</p></td>
<td><p>list, pd.Series</p></td>
</tr>
<tr class="row-even"><td><p>route_types</p></td>
<td><p>list, pd.Series</p></td>
</tr>
</tbody>
</table>
</div>
<p>Mapping, charting, and metric generation methods, listed under “dynamic tools” in the chart above, will respect the current filter. After generating your desired output, you can call <code class="docutils literal notranslate"><span class="pre">set_filter</span></code> again to set a new filter, or use <code class="docutils literal notranslate"><span class="pre">reset_filter</span></code> to remove the filter entirely. Then you can continue to analyze, without needing to create a new RtFilterMapper instance.</p>
</section>
<section id="mapping">
<h3>Mapping<a class="headerlink" href="#mapping" title="Link to this heading">#</a></h3>
<p>Use the <code class="docutils literal notranslate"><span class="pre">segment_speed_map</span></code> method to generate a speed map. Depending on parameters, the speeds visualized will either be the 20th percentile or average speeds for all trips in each segment matching the current filter, if any. See function docstring for additional information.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map_variance</span></code> method, currently under development, offers a spatial view of variation in speeds for all trips in each segment matching the current filter, if any. This is now quantified as the ratio between 80th percentile and 20th percentile speeds, and used on the CA Transit Speed Maps tool.</p>
</section>
<section id="more-performant-maps-via-embedded-app">
<h3>More performant maps via embedded app<a class="headerlink" href="#more-performant-maps-via-embedded-app" title="Link to this heading">#</a></h3>
<p>Rather than render the maps directly in the notebook via geopandas and folium, we now have the capability to save them as compressed GeoJSON to GCS and render them in an IFrame using a <a class="reference external" href="https://github.com/cal-itp/data-infra/tree/main/apps/maps">minimal web app</a>.</p>
<p>This method is much more efficient, and we rely on it to maintain the quantity and quality of maps on the <a class="reference external" href="https://analysis.calitp.org/rt/README.html">CA Transit Speed Maps</a> site.</p>
<p><code class="docutils literal notranslate"><span class="pre">display_spa_map</span></code> will always show the most recent map generated with either <code class="docutils literal notranslate"><span class="pre">segment_speed_map</span></code> or <code class="docutils literal notranslate"><span class="pre">map_variance</span></code>, then saved via <code class="docutils literal notranslate"><span class="pre">map_gz_export</span></code>.</p>
</section>
<section id="stop-segment-speed-view">
<h3><code class="docutils literal notranslate"><span class="pre">stop_segment_speed_view</span></code><a class="headerlink" href="#stop-segment-speed-view" title="Link to this heading">#</a></h3>
<p>After generating a speed map, the underlying data is available at RtFilterMapper.stop_segment_speed_view, a geodataframe. This data can be easily exported into a geoparquet, geojson, shapefile, or spreadsheet with the appropriate geopandas method.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Column</p></td>
<td><p>Source</p></td>
<td><p>Type</p></td>
</tr>
<tr class="row-odd"><td><p>shape_meters</p></td>
<td><p>Projection of GTFS Stop along GTFS Shape (with 0 being start of shape), additionally 1km segments generated where stops are infrequent</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>stop_id</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-odd"><td><p>stop_name</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-even"><td><p>geometry</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>geometry</p></td>
</tr>
<tr class="row-odd"><td><p>shape_id</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-even"><td><p>trip_id</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-odd"><td><p>stop_sequence</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>route_id</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-odd"><td><p>route_short_name</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>string</p></td>
</tr>
<tr class="row-even"><td><p>direction_id</p></td>
<td><p>GTFS Schedule</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>delay_seconds*</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">stop_delay_view</span></code></p></td>
<td><p>np.datetime64[ns]</p></td>
</tr>
<tr class="row-even"><td><p>seconds_from_last*</p></td>
<td><p>time for trip to travel to this stop from last stop</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>last_loc*</p></td>
<td><p>previous stop <code class="docutils literal notranslate"><span class="pre">shape_meters</span></code></p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>meters_from_last*</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shape_meters</span></code> - <code class="docutils literal notranslate"><span class="pre">last_loc</span></code></p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>speed_from_last*</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">meters_from_last</span></code> / <code class="docutils literal notranslate"><span class="pre">seconds_from_last</span></code></p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>delay_chg_sec*</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delay_seconds</span></code> - delay at last stop</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>speed_mph*</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">speed_from_last</span></code> converted to miles per hour</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>n_trips_shp**</p></td>
<td><p>number of unique trips on this GTFS shape in filter</p></td>
<td><p>int64</p></td>
</tr>
<tr class="row-odd"><td><p>avg_mph**</p></td>
<td><p>average speed for all trips on this segment</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>_20p_mph**</p></td>
<td><p>20th percentile speed for all trips on this segment</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>_80p_mph**</p></td>
<td><p>80th percentile speed for all trips on this segment</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-even"><td><p>fast_slow_ratio**</p></td>
<td><p>ratio between p80 speed and p20 speed for all trips on this segment</p></td>
<td><p>float64</p></td>
</tr>
<tr class="row-odd"><td><p>trips_per_hour</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">n_trips_shp</span></code> / hours in filter</p></td>
<td><p>float64</p></td>
</tr>
</tbody>
</table>
</div>
<p>*disaggregate value – applies to this trip only</p>
<p>**aggregated value – based on all trips in filter</p>
</section>
<section id="other-charts-and-metrics">
<h3>Other Charts and Metrics<a class="headerlink" href="#other-charts-and-metrics" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">chart_variability</span></code> method provides a descriptitive view of the speeds experienced by each trip in each segments. It requires that a filter first be set to only one shape_id.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">chart_speeds</span></code> and <code class="docutils literal notranslate"><span class="pre">chart_delays</span></code> methods provide aggregate charts showing speed and delay patterns throughout the day.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">describe_slow_routes</span></code> method lists out the routes in the current filter experiencing the lowest speeds. It is mainly used on the California Transit Speed Maps site.</p>
</section>
<section id="corridor-analysis">
<h3>Corridor Analysis<a class="headerlink" href="#corridor-analysis" title="Link to this heading">#</a></h3>
<p>It’s often useful to measure transit delay on a specific corridor to support technical metric generation for the Solutions for Congested Corridors Program, Local Partnership Program, and other analyses.</p>
<p>If you’ve received a corridor from an SCCP/LPP applicant or elsewhere, load it as a geodataframe and add it using the <code class="docutils literal notranslate"><span class="pre">add_corridor</span></code> method. If you’re already looking at a speed map and want to measure delay for a portion of the map, you can use the <code class="docutils literal notranslate"><span class="pre">autocorridor</span></code> method to specify a corridor using a shape_id and two stop_sequences. This saves time by avoiding the need to generate the polygon elsewhere.</p>
<p>The corridor must be a single polygon, and in order to generate metrics it must include at least one transit stop.</p>
<p>Once the corridor is attached, the <code class="docutils literal notranslate"><span class="pre">quick_map_corridor</span></code> method is available to generate an overview map of the corridor, including the transit stops just before, within, and just after the corridor. The <code class="docutils literal notranslate"><span class="pre">corridor_metrics</span></code> method will generate both a speed-based and schedule-based transit delay metric.</p>
<p>The speed-based metric is a daily average of the sum of delays for each trip traversing the corridor as compared to a reference speed of 16 miles per hour. To further explain, we take each corridor trip that we have data for and calculate the hypothetical time it would take for that trip to traverse the corridor at a speed of 16 mph. The difference between the actual time it took for the trip to traverse the corridor and that hypothetical time is the speed-based delay for that trip, and we sum those delays to create the metric. This metric is intended to provide a more consistent basis for comparison independent of scheduling practices.</p>
<p>In other words, if we expect a hypothetical bus lane/signal priority/payment system etc to increase corridor speeds to 16mph, this is how much time we could save per day.</p>
<p>The schedule-based metric is a daily average of the sum of median trip stop delays along the corridor. To further explain, we take each corridor trip that we have data for and look at the delay in comparison to the schedule at each stop, after subtracting off any delay present as the trip entered the corridor. For each trip we then take the median delay of all stops along the corridor, and sum these medians to create the metric.</p>
<p>Finally, you can use the <code class="docutils literal notranslate"><span class="pre">corridor</span> <span class="pre">=</span> <span class="pre">True</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">segment_speed_map</span></code> method to generate a speed map for only corridor segments.</p>
<p>While all of these methods respect any filter you may have set with <code class="docutils literal notranslate"><span class="pre">set_filter</span></code>, don’t set a filter for SCCP/LPP metric generation.</p>
</section>
</section>
<section id="example-workflow-california-transit-speed-maps">
<h2>Example Workflow: California Transit Speed Maps<a class="headerlink" href="#example-workflow-california-transit-speed-maps" title="Link to this heading">#</a></h2>
<p>See <a class="reference external" href="https://github.com/cal-itp/data-analyses/blob/main/ca_transit_speed_maps/technical_notes.md"><code class="docutils literal notranslate"><span class="pre">data_analyses/ca_transit_speed_maps/technical_notes.md</span></code></a> !</p>
</section>
<section id="example-workflow-sccp">
<h2>Example Workflow: SCCP<a class="headerlink" href="#example-workflow-sccp" title="Link to this heading">#</a></h2>
<div class="mermaid">
            flowchart TD
    rcv_corr[/receive corridor from applicant/] --&gt;
    ver_corr[/verify corridor is polygon/] --&gt;
    gen_data[generate analysis data for timeframe*]
    subgraph fm[RtFilterMapper]
        atc_corr[&quot;attach corridor (self.add_corridor)&quot;]
        atc_corr --&gt; metrics[self.corridor_metrics]
        atc_corr -.-&gt; self.quick_map_corridor
        atc_corr -.-&gt; map_corr[&quot;corridor = True on speedmaps&quot;]
    end
    gen_data --&gt; fm
    metrics --&gt; pub&gt;&quot;share both speed and schedule metrics (appropriately averaged for SCCP/LPP)&quot;]
        </div><p>Note that these steps are substantially automated using the <code class="docutils literal notranslate"><span class="pre">rt_analysis.sccp_tools.sccp_average_metrics</span></code> function.</p>
<ul class="simple">
<li><p>2022 SCCP/LPP default timeframe is Apr 30 - May 9 2022.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./analytics_tools"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="scripts.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Scripts</p>
      </div>
    </a>
    <a class="right-next"
       href="saving_code.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Saving Code</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rt-filter-map-plot-your-flexible-analytics-and-mapping-interface"><code class="docutils literal notranslate"><span class="pre">rt_filter_map_plot</span></code>: your flexible analytics and mapping interface</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-intermediate-data-largely-automatically">Loading Intermediate Data (largely automatically)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering">Filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping">Mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-performant-maps-via-embedded-app">More performant maps via embedded app</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stop-segment-speed-view"><code class="docutils literal notranslate"><span class="pre">stop_segment_speed_view</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-charts-and-metrics">Other Charts and Metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corridor-analysis">Corridor Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow-california-transit-speed-maps">Example Workflow: California Transit Speed Maps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-workflow-sccp">Example Workflow: SCCP</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Cal-ITP
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>