version: 2
exposures:
  - name: safety___security___all_events
    label: Safety & Security – All Events
    description: "### Visualization: Bar\n\nNo description provided in Metabase\n\n\
      #### Query\n\n```\nWITH all_agencies AS (\n  -- Tables using 'state'\n  SELECT\
      \ DISTINCT agency, state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_breakdowns`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_capital_expenses_by_capital_use`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_employees_by_mode_and_employee_type`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_fuel_and_energy` WHERE state\
      \ = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_by_expense_type`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_directly_generated`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_federal`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_local` WHERE\
      \ state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_state`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_funding_sources_taxes_levied_by_agency`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_maintenance_facilities`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_metrics` WHERE state = 'CA'\n\
      \  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_operating_expenses_by_function`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_operating_expenses_by_type`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, _5_digit_ntd_id\
      \ AS ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_service_by_mode_and_time_period`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_stations_and_facilities_by_agency_and_facility_type`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_track_and_roadway_by_mode`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_vehicles_age_distribution`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, state, ntd_id FROM\
      \ `cal-itp-data-infra.mart_ntd_annual_reporting.fct_vehicles_type_count_by_agency`\
      \ WHERE state = 'CA'\n  UNION ALL\n  SELECT DISTINCT agency, max_state AS state,\
      \ _5_digit_ntd_id AS ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_service_by_agency`\
      \ WHERE max_state = 'CA'\n  -- Tables using 'max_state'\n  UNION ALL\n  SELECT\
      \ DISTINCT max_agency, max_state AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_breakdowns_by_agency`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_capital_expenses_by_mode`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_capital_expenses_for_existing_service`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_capital_expenses_for_expansion_of_service`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_fuel_and_energy_by_agency`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_maintenance_facilities_by_agency`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, _5_digit_ntd_id AS ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_service_by_mode`\
      \ WHERE max_state = 'CA'\n  UNION ALL\n  SELECT DISTINCT max_agency, max_state\
      \ AS state, ntd_id FROM `cal-itp-data-infra.mart_ntd_annual_reporting.fct_track_and_roadway_by_agency`\
      \ WHERE max_state = 'CA'\n)\nSELECT DISTINCT agency, ntd_id, state\nFROM all_agencies\n\
      WHERE ntd_id IS NOT NULL\nORDER BY ntd_id;\n```\n\n#### Metadata\n\nMetabase\
      \ ID: __3573__\n\nCreated On: __2025-04-21T20:43:51.05782Z__"
    type: analysis
    url: https://dashboards.calitp.org/card/3573
    maturity: medium
    owner:
      name: Charlie Costanzo
      email: charlie.c@jarv.us
    depends_on: []
    config:
      meta:
        average_query_time: '0:00.924'
        last_used_at: '2025-07-09T05:02:55.21969Z'
