version: 2
exposures:
  - name: outcomes____shapes_txt
    label: Outcomes || shapes.txt
    description: "### Visualization: Line\n\nThe share of providers with a shapes.txt\
      \ file.\n\n#### Query\n\n```\nWITH \n    provider_count AS (\n        SELECT\n\
      \            date,\n            n_feeds AS n_providers\n        FROM views.gtfs_schedule_fact_daily\n\
      \        WHERE date < CURRENT_DATE AND date >= '2021-07-01'\n        ORDER BY\
      \ 1 DESC\n    ),\n    shape_count AS (\n    SELECT \n        date,\n       \
      \ COUNT(DISTINCT calitp_feed_id) AS n_shapes\n    FROM views.gtfs_schedule_fact_daily_files\n\
      \    INNER JOIN (SELECT feed_key, calitp_feed_id FROM views.gtfs_schedule_dim_feeds)\n\
      \    USING(feed_key)\n    WHERE date >= '2021-07-01' AND file_key = 'shapes.txt'\n\
      \    GROUP BY 1\n    ORDER BY 1 DESC\n    )\nSELECT \n    date,\n    -- COALESCE(n_providers,\
      \ 0) AS n_providers,\n    -- COALESCE(n_shapes, 0) AS n_shapes,\n    COALESCE(n_shapes/n_providers,\
      \ 0) AS pct_shapes\nFROM provider_count\nFULL JOIN shape_count\n    USING(date)\n\
      ORDER BY date DESC\n```\n\n#### Metadata\n\nMetabase ID: __79__\n\nCreated On:\
      \ __2021-08-20T13:02:05.172316Z__"
    type: analysis
    url: https://dashboards.calitp.org/card/79
    maturity: medium
    owner:
      name: Chris Cardillo
      email: chris.c@jarv.us
    depends_on: []
    config:
      meta:
        last_used_at: '2024-09-20T17:54:54.131902Z'
