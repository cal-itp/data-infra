version: 2
exposures:
  - name: percent_of_riders_receiving_fare_adjustments_per_month__grouped_by_adjustment_type_1
    label: Percent of Riders receiving Fare Adjustments per Month, grouped by Adjustment
      Type
    description: "### Visualization: Bar\n\nNo description provided in Metabase\n\n\
      #### Query\n\n```\nWITH\nrides_with_adjustments AS (\n    SELECT\n        datetime_trunc(`uploaded_data.synthetic_payments_rides`.`transaction_date_time_pacific`,\
      \ month) AS `transaction_date_time_pacific`,\n        `uploaded_data.synthetic_payments_rides`.`adjustment_description`,\n\
      \        count(distinct `uploaded_data.synthetic_payments_rides`.`principal_customer_id`)\
      \ AS `count`\n    FROM `uploaded_data.synthetic_payments_rides`\n    WHERE (`uploaded_data.synthetic_payments_rides`.`adjustment_id`\
      \ IS NOT NULL\n        AND (`uploaded_data.synthetic_payments_rides`.`adjustment_id`\
      \ <> ''\n        OR `uploaded_data.synthetic_payments_rides`.`adjustment_id`\
      \ IS NULL))\n        [[AND (transaction_date_time_pacific)]]\n        [[AND\
      \ (participant_id)]]\n    GROUP BY `adjustment_description`, `transaction_date_time_pacific`\n\
      ),\nrides AS (\n    SELECT\n        datetime_trunc(`uploaded_data.synthetic_payments_rides`.`transaction_date_time_pacific`,\
      \ month) AS `transaction_date_time_pacific`,\n        count(distinct `uploaded_data.synthetic_payments_rides`.`principal_customer_id`)\
      \ AS `count`\n    FROM `uploaded_data.synthetic_payments_rides`\n    WHERE true\n\
      \        [[AND (transaction_date_time_pacific)]]\n        [[AND (participant_id)]]\n\
      \    GROUP BY `transaction_date_time_pacific`\n)\nSELECT\n    `transaction_date_time_pacific`,\n\
      \    `adjustment_description`,\n    100.0 * rides_with_adjustments.count / rides.count\
      \ AS `percent`\nFROM rides\nJOIN rides_with_adjustments USING (`transaction_date_time_pacific`)\n\
      ORDER BY `adjustment_description` ASC\n```\n\n#### Metadata\n\nMetabase ID:\
      \ __567__\n\nCreated On: __2022-09-28T21:21:26.856809Z__"
    type: analysis
    url: https://dashboards.calitp.org/card/567
    maturity: medium
    owner:
      name: Charlie Costanzo
      email: charlie.c@jarv.us
    depends_on: []
    config:
      meta:
        average_query_time: '0:02.217'
        last_used_at: '2025-04-17T18:24:32.913556Z'
