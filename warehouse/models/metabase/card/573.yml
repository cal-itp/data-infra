version: 2
exposures:
  - name: __of_first_time_customers_per_week
    label: '% of First-time Customers per Week'
    description: "### Visualization: Bar\n\nNo description provided in Metabase\n\n\
      #### Query\n\n```\nWITH\n  customer_first_rides AS (\n  SELECT\n    datetime_trunc(`transaction_date_time_pacific`,\
      \ week(saturday)) AS `transaction_week`,\n    COUNT(`principal_customer_id`)\
      \ first_time_rider_count\n  FROM (\n    SELECT\n        `principal_customer_id`,\n\
      \        MIN(`transaction_date_time_pacific`) AS `transaction_date_time_pacific`\n\
      \    FROM `cal-itp-data-infra.views.payments_rides` AS `views.payments_rides`\n\
      \    WHERE true\n      [[AND (participant_id)]]\n      [[AND (transaction_date_time_pacific)]]\n\
      \    GROUP BY `principal_customer_id`\n)\n  GROUP BY\n    `transaction_week`),\n\
      \  all_rides AS (\n  SELECT\n        datetime_trunc(`transaction_date_time_pacific`,\
      \ week(saturday)) AS `transaction_week`,\n        COUNT(`principal_customer_id`)\
      \ all_rider_count\n  FROM (\n    SELECT\n        `principal_customer_id`,\n\
      \        `transaction_date_time_pacific`\n    FROM `cal-itp-data-infra.views.payments_rides`\
      \ AS `views.payments_rides`\n    WHERE true\n      [[AND (participant_id)]]\n\
      \      [[AND (transaction_date_time_pacific)]]\n)  GROUP BY\n    `transaction_week`)\n\
      SELECT\n  `transaction_week`,\n  first_time_rider_count,\n  all_rider_count,\n\
      \  ROUND(first_time_rider_count/all_rider_count, 4) * 100 AS `proportion_of_new_customers`\n\
      FROM\n  `customer_first_rides`\nJOIN\n  `all_rides`\nUSING\n  (`transaction_week`)\n\
      ORDER BY\n  `transaction_week`\n```\n\n#### Metadata\n\nMetabase ID: __573__\n\
      \nCreated On: __2022-10-27T19:48:34.041756Z__"
    type: analysis
    url: https://dashboards.calitp.org/card/573
    maturity: medium
    owner:
      name: Jameelah Young
      email: jameelah.y@jarv.us
    depends_on: []
    config:
      meta:
        average_query_time: '0:01.102'
        last_used_at: '2024-09-20T17:54:54.131902Z'
