version: 2
exposures:
  - name: outcomes____fare_rules_txt_or_fare_leg_rules_txt
    label: Outcomes || fare_rules.txt or fare_leg_rules.txt
    description: "### Visualization: Table\n\nShare of providers with fare_rules.txt\
      \ or fare_leg_rules.txt\n\n#### Query\n\n```\nWITH \n    provider_count AS (\n\
      \        SELECT\n            date,\n            n_feeds AS n_providers\n   \
      \     FROM views.gtfs_schedule_fact_daily\n        WHERE date < CURRENT_DATE\
      \ AND date >= '2021-07-01'\n        ORDER BY 1 DESC\n    ),\n    fare_count\
      \ AS (\n    SELECT \n        date,\n        COUNT(DISTINCT calitp_feed_id) AS\
      \ n_fares\n    FROM views.gtfs_schedule_fact_daily_files\n    INNER JOIN (SELECT\
      \ feed_key, calitp_feed_id FROM views.gtfs_schedule_dim_feeds)\n        USING(feed_key)\n\
      \    WHERE date >= '2021-07-01' AND file_key IN ('fare_rules.txt', 'fare_leg_rules.txt')\n\
      \    GROUP BY 1\n    ORDER BY 1 DESC\n    )\nSELECT \n    date,\n    -- COALESCE(n_providers,\
      \ 0) AS n_providers,\n    -- COALESCE(n_fares, 0) AS n_fares,\n    COALESCE(n_fares/n_providers,\
      \ 0) AS pct_fares\nFROM provider_count\nFULL JOIN fare_count\n    USING(date)\n\
      ORDER BY date DESC\n```\n\n#### Metadata\n\nMetabase ID: __80__\n\nCreated On:\
      \ __2021-08-20T13:08:59.906355Z__"
    type: analysis
    url: https://dashboards.calitp.org/card/80
    maturity: medium
    owner:
      name: Chris Cardillo
      email: chris.c@jarv.us
    depends_on: []
    config:
      meta:
        last_used_at: '2024-09-20T17:54:54.131902Z'
