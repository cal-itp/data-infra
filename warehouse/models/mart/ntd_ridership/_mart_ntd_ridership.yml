version: 2

x-common-fields:
  - &key
    name: key
    tests:
      - not_null
      - unique
  - &ntd_id
    name: ntd_id
    description: '{{ doc("ntd_id") }}'
    tests:
      - not_null
  - &agency
    name: agency
    description: '{{ doc("ntd_agency") }}'
  - &agency_name
    name: agency_name
    description: '{{ doc("ntd_agency_name") }}'
  - &legacy_ntd_id
    name: legacy_ntd_id
    description: '{{ doc("ntd_legacy_id") }}'
  - &state_parent_ntd_id
    name: state_parent_ntd_id
    description: '{{ doc("ntd_state_parent_ntd_id") }}'
  - &report_year
    name: report_year
    description: '{{ doc("ntd_report_year") }}'
  - &reporter_type
    name: reporter_type
    description: '{{ doc("ntd_reporter_type") }}'
  - &organization_type
    name: organization_type
    description: '{{ doc("ntd_organization_type") }}'
  - &city
    name: city
    description: '{{ doc("ntd_city") }}'
  - &state
    name: state
    description: '{{ doc("ntd_state") }}'
  - &doing_business_as
    name: doing_business_as
    description: '{{ doc("ntd_doing_business_as") }}'
  - &address_line_1
    name: address_line_1
    description: '{{ doc("ntd_mailing_address_line_1") }}'
  - &address_line_2
    name: address_line_2
    description: '{{ doc("ntd_mailing_address_line_2") }}'
  - &p_o__box
    name: p_o__box
    description: '{{ doc("ntd_mailing_p_o_box") }}'
  - &mailing_city
    name: city
    description: '{{ doc("ntd_mailing_city") }}'
  - &mailing_state
    name: state
    description: '{{ doc("ntd_mailing_state") }}'
  - &zip_code
    name: zip_code
    description: '{{ doc("ntd_mailing_zip_code") }}'
  - &zip_code_ext
    name: zip_code_ext
    description: '{{ doc("ntd_mailing_zip_code_ext") }}'
  - &region
    name: region
    description: '{{ doc("ntd_region") }}'
  - &density
    name: density
    description: '{{ doc("ntd_density") }}'
  - &ueid
    name: ueid
    description: '{{ doc("ntd_ueid") }}'
  - &fta_recipient_id
    name: fta_recipient_id
    description: '{{ doc("ntd_fta_recipient_id") }}'
  - &original_due_date
    name: original_due_date
    description: '{{ doc("ntd_original_due_date") }}'
  - &fy_end_date
    name: fy_end_date
    description: '{{ doc("ntd_fy_end_date") }}'
  - &number_of_counties_with_service
    name: number_of_counties_with_service
    description: '{{ doc("ntd_number_of_counties_with_service") }}'
  - &number_of_state_counties
    name: number_of_state_counties
    description: '{{ doc("ntd_number_of_state_counties") }}'
  - &personal_vehicles
    name: personal_vehicles
    description: '{{ doc("ntd_personal_vehicles") }}'
  - &reported_by_name
    name: reported_by_name
    description: '{{ doc("ntd_reported_by_name") }}'
  - &reported_by_ntd_id
    name: reported_by_ntd_id
    description: '{{ doc("ntd_reported_by_ntd_id") }}'
  - &reporter_acronym
    name: reporter_acronym
    description: '{{ doc("ntd_reporter_acronym") }}'
  - &reporting_module
    name: reporting_module
    description: '{{ doc("ntd_reporting_module") }}'
  - &state_admin_funds_expended
    name: state_admin_funds_expended
    description: '{{ doc("ntd_state_admin_funds_expended") }}'
  - &subrecipient_type
    name: subrecipient_type
    description: '{{ doc("ntd_subrecipient_type") }}'
  - &tam_tier
    name: tam_tier
    description: '{{ doc("ntd_tam_tier") }}'
  - &tribal_area_name
    name: tribal_area_name
    description: '{{ doc("ntd_tribal_area_name") }}'
  - &url
    name: url
    description: '{{ doc("ntd_agency_url") }}'
  - &volunteer_drivers
    name: volunteer_drivers
    description: '{{ doc("ntd_volunteer_drivers") }}'
  - &primary_uza_code
    name: primary_uza_code
    description: '{{ doc("ntd_primary_uza_code") }}'
  - &primary_uza_name
    name: primary_uza_name
    description: '{{ doc("ntd_primary_uza_name") }}'
  - &primary_uza_area_sq_miles
    name: primary_uza_area_sq_miles
    description: '{{ doc("ntd_primary_uza_area_sq_miles") }}'
  - &primary_uza_population
    name: primary_uza_population
    description: '{{ doc("ntd_primary_uza_population") }}'
  - &service_area_population
    name: service_area_population
    description: '{{ doc("ntd_service_area_population") }}'
  - &service_area_sq_miles
    name: service_area_sq_miles
    description: '{{ doc("ntd_service_area_sq_miles") }}'
  - &type_of_service
    name: type_of_service
    description: '{{ doc("ntd_type_of_service") }}'
  - &mode
    name: mode
    description: '{{ doc("ntd_mode") }}'
  - &mode_name
    name: mode_name
    description: '{{ doc("ntd_mode_name") }}'
  - &_3_mode
    name: _3_mode
    description: '{{ doc("ntd_3_mode") }}'
  - &time_period
    name: time_period
    description: '{{ doc("ntd_time_period") }}'
  - &questionable_data
    name: questionable_data
    description: '{{ doc("ntd_questionable_data") }}'
  - &agency_voms
    name: agency_voms
    description: '{{ doc("ntd_agency_voms") }}'
  - &actual_vehicles_passenger_car_hours
    name: actual_vehicles_passenger_car_hours
    description: '{{ doc("ntd_actual_vehicles_passenger_car_hours") }}'
  - &actual_vehicles_passenger_car_deadhead_hours
    name: actual_vehicles_passenger_car_deadhead_hours
    description: '{{ doc("ntd_actual_vehicles_passenger_car_deadhead_hours") }}'
  - &actual_vehicles_passenger_car_revenue_hours
    name: actual_vehicles_passenger_car_revenue_hours
    description: '{{ doc("ntd_actual_vehicles_passenger_car_revenue_hours") }}'
  - &charter_service_hours
    name: charter_service_hours
    description: '{{ doc("ntd_charter_service_hours") }}'
  - &school_bus_hours
    name: school_bus_hours
    description: '{{ doc("ntd_school_bus_hours") }}'
  - &train_hours
    name: train_hours
    description: '{{ doc("ntd_train_hours") }}'
  - &train_revenue_hours
    name: train_revenue_hours
    description: '{{ doc("ntd_train_revenue_hours") }}'
  - &train_deadhead_hours
    name: train_deadhead_hours
    description: '{{ doc("ntd_train_deadhead_hours") }}'
  - &passengers_per_hour
    name: passengers_per_hour
    description: '{{ doc("ntd_passengers_per_hour") }}'
  - &actual_vehicles_passenger_car_miles
    name: actual_vehicles_passenger_car_miles
    description: '{{ doc("ntd_actual_vehicles_passenger_car_miles") }}'
  - &actual_vehicles_passenger_car_revenue_miles
    name: actual_vehicles_passenger_car_revenue_miles
    description: '{{ doc("ntd_actual_vehicles_passenger_car_revenue_miles") }}'
  - &actual_vehicles_passenger_deadhead_miles
    name: actual_vehicles_passenger_deadhead_miles
    description: '{{ doc("ntd_actual_vehicles_passenger_deadhead_miles") }}'
  - &scheduled_vehicles_passenger_car_revenue_miles
    name: scheduled_vehicles_passenger_car_revenue_miles
    description: '{{ doc("ntd_scheduled_vehicles_passenger_car_revenue_miles") }}'
  - &directional_route_miles
    name: directional_route_miles
    description: '{{ doc("ntd_directional_route_miles") }}'
  - &passenger_miles
    name: passenger_miles
    description: '{{ doc("ntd_passenger_miles") }}'
  - &train_miles
    name: train_miles
    description: '{{ doc("ntd_train_miles") }}'
  - &train_revenue_miles
    name: train_revenue_miles
    description: '{{ doc("ntd_train_revenue_miles") }}'
  - &train_deadhead_miles
    name: train_deadhead_miles
    description: '{{ doc("ntd_train_deadhead_miles") }}'
  - &trains_in_operation
    name: trains_in_operation
    description: '{{ doc("ntd_trains_in_operation") }}'
  - &ada_upt
    name: ada_upt
    description: '{{ doc("ntd_ada_upt") }}'
  - &sponsored_service_upt
    name: sponsored_service_upt
    description: '{{ doc("ntd_sponsored_service_upt") }}'
  - &unlinked_passenger_trips_upt
    name: unlinked_passenger_trips_upt
    description: '{{ doc("ntd_unlinked_passenger_trips_upt") }}'
  - &mode_voms
    name: mode_voms
    description: '{{ doc("ntd_mode_voms") }}'
  - &time_service_begins
    name: time_service_begins
    description: '{{ doc("ntd_time_service_begins") }}'
  - &time_service_ends
    name: time_service_ends
    description: '{{ doc("ntd_time_service_ends") }}'
  - &days_of_service_operated
    name: days_of_service_operated
    description: '{{ doc("ntd_days_of_service_operated") }}'
  - &days_not_operated_strikes
    name: days_not_operated_strikes
    description: '{{ doc("ntd_days_not_operated_strikes") }}'
  - &days_not_operated_emergencies
    name: days_not_operated_emergencies
    description: '{{ doc("ntd_days_not_operated_emergencies") }}'
  - &average_passenger_trip_length_aptl_
    name: average_passenger_trip_length_aptl_
    description: '{{ doc("ntd_average_passenger_trip_length_aptl_") }}'
  - &average_speed
    name: average_speed
    description: '{{ doc("ntd_average_speed") }}'
  - &brt_non_statutory_mixed_traffic
    name: brt_non_statutory_mixed_traffic
    description: '{{ doc("ntd_brt_non_statutory_mixed_traffic") }}'
  - &mixed_traffic_right_of_way
    name: mixed_traffic_right_of_way
    description: '{{ doc("ntd_mixed_traffic_right_of_way") }}'
  - &mode_type_of_service_status
    name: mode_type_of_service_status
    description: '{{ doc("ntd_mode_type_of_service_status") }}'
  - &service_type
    name: service_type
    description: '{{ doc("ntd_ridership_service_type") }}'
  - &upt
    name: upt
    description: '{{ doc("ntd_upt") }}'
  - &voms
    name: voms
    description: '{{ doc("ntd_voms") }}'
  - &vrh
    name: vrh
    description: '{{ doc("ntd_vrh") }}'
  - &vrm
    name: vrm
    description: '{{ doc("ntd_vrm") }}'
  - &period_month
    name: period_month
    description: '{{ doc("ntd_period_month") }}'
  - &period_year
    name: period_year
    description: '{{ doc("ntd_period_year") }}'
  - &period_year_month
    name: period_year_month
    description: '{{ doc("ntd_period_year_month") }}'
  - &_dt
    name: _dt
    description: '{{ doc("ntd_extracting_date") }}'
  - &execution_ts
    name: execution_ts
    description: '{{ doc("ntd_execution_timestamp") }}'

models:
  - name: fct_monthly_ridership_with_adjustments
    description: >-
      Extracts of the NTD Complete Monthly Ridership with Adjustments and Estimates (UPT, VOMS, VRH, and VRM)
      that contains all monthly module data reported to the NTD since January 2002.
      Mode and Type of Service Changes and Impacts on this Time Series

      Monthly data are reported by mode and type of service.
      From 2002 through 2011, there were 16 modes in the NTD.
      NTD monthly ridership data is now reported according to refined modal classifications.
      Service previously reported as bus (MB) now may be reported as either MB, Commuter Bus (CB),
      or Bus Rapid Transit (RB).
      Additionally, service previously categorized as Light Rail (LR) now may be reported as LR or
      Streetcar (SR).

      Similarly, Types of Service were refined in Report Year 2019.
      From 2002 - 2018, there were two types of service:
        Directly Operated (DO) and
        Purchased Transportation (PT).

      As of 2019, Purchased Transportation is now classified such that agencies report the
      purchased transportation based on the type of contractor:
        general third party (PT),
        taxicab operator (TX),
        or transportation network company (TN).

      FTA concurrently removed the "Demand Response Taxi" (DT/PT) mode in 2019.
      FTA now considers all such service as Demand Response (DR) with Taxi (TX) type of service and
      this time series has been updated to reflect this change.

      This time series also considers modes which have been combined, collapsing the
      Automated Guideway (AG) and Monorail (MO) mode historical data into the
      Monorail/Automated Guideway (MG) mode to reflect the current reporting arrangement and
      allow for easier analysis of these modes.

      Finally, FTA introduced the Hybrid Rail (YR) mode in January 2012. While this mode combines
      some systems previously classified as either Commuter Rail (CR) or Light Rail (LR),
      this change could not be done uniformly; most operators of Hybrid Rail continued to
      offer services presently defined as CR or LR.
      Therefore, this time series does not attempt to combine historically.
      Data users should therefore take caution that the following systems converted completely
      from Commuter Rail to Hybrid Rail around this time:
      - 60048 Capital Metropolitan Transportation Authority (Commuter Rail to Hybrid Rail)
      - 60101 Denton County Transportation Authority (Commuter Rail to Hybrid Rail)
      - 90030 North County Transit District (Light Rail to Hybrid Rail)

      The dataset is found at:
        https://www.transit.dot.gov/ntd/data-product/monthly-module-adjusted-data-release.

      For more information use the glossary of transit terms located at:
        https://www.transit.dot.gov/ntd/national-transit-database-ntd-glossary
      or the reporting manuals located at:
        https://www.transit.dot.gov/ntd/manuals.

    columns:
      - *key
      - *_dt
      - *execution_ts
      - *period_year_month
      - *period_month
      - *period_year
      - *ntd_id
      - *reporter_type
      - *agency
      - *mode_type_of_service_status
      - *mode
      - *mode_name
      - *_3_mode
      - *service_type
      - <<: *type_of_service
        name: tos
      - *legacy_ntd_id
      - *primary_uza_name
      - *primary_uza_code
      - *upt
      - *voms
      - *vrh
      - *vrm
