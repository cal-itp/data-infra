version: 2

x-common-fields:
  - &ntd_id
    name: ntd_id
    description: '{{ doc("ntd_id") }}'
  - &agency
    name: agency
    description: '{{ doc("ntd_agency") }}'
  - &legacy_ntd_id
    name: legacy_ntd_id
    description: '{{ doc("ntd_legacy_id") }}'
  - &report_year
    name: report_year
    description: '{{ doc("ntd_report_year") }}'
  - &reporter_type
    name: reporter_type
    description: '{{ doc("ntd_reporter_type") }}'
  - &organization_type
    name: organization_type
    description: '{{ doc("ntd_organization_type") }}'
  - &city
    name: city
    description: '{{ doc("ntd_city") }}'
  - &state
    name: state
    description: '{{ doc("ntd_state") }}'
  - &primary_uza_code
    name: primary_uza_code
    description: '{{ doc("ntd_primary_uza_code") }}'
  - &primary_uza_name
    name: primary_uza_name
    description: '{{ doc("ntd_primary_uza_name") }}'
  - &primary_uza_area_sq_miles
    name: primary_uza_area_sq_miles
    description: '{{ doc("ntd_primary_uza_area_sq_miles") }}'
  - &primary_uza_population
    name: primary_uza_population
    description: '{{ doc("ntd_primary_uza_population") }}'
  - &service_area_population
    name: service_area_population
    description: '{{ doc("ntd_service_area_population") }}'
  - &service_area_sq_miles
    name: service_area_sq_miles
    description: '{{ doc("ntd_service_area_sq_miles") }}'
  - &type_of_service
    name: type_of_service
    description: '{{ doc("ntd_type_of_service") }}'
  - &mode
    name: mode
    description: '{{ doc("ntd_mode") }}'
  - &mode_name
    name: mode_name
    description: '{{ doc("ntd_mode_name") }}'
  - &_3_mode
    name: _3_mode
    description: '{{ doc("ntd_3_mode") }}'
  - &time_period
    name: time_period
    description: '{{ doc("ntd_time_period") }}'
  - &questionable_data
    name: questionable_data
    description: '{{ doc("ntd_questionable_data") }}'
  - &agency_voms
    name: agency_voms
    description: '{{ doc("ntd_agency_voms") }}'
  - &actual_vehicle_hours
    name: actual_vehicle_hours
    description: '{{ doc("ntd_actual_vehicle_hours") }}'
  - &mode_type_of_service_status
    name: mode_type_of_service_status
    description: '{{ doc("ntd_mode_type_of_service_status") }}'
  - &service_type
    name: service_type
    description: '{{ doc("ntd_ridership_service_type") }}'
  - &upt
    name: upt
    description: '{{ doc("ntd_upt") }}'
  - &voms
    name: voms
    description: '{{ doc("ntd_voms") }}'
  - &vrh
    name: vrh
    description: '{{ doc("ntd_vrh") }}'
  - &vrm
    name: vrm
    description: '{{ doc("ntd_vrm") }}'
  - &period_month
    name: period_month
    description: '{{ doc("ntd_period_month") }}'
  - &period_year
    name: period_year
    description: '{{ doc("ntd_period_year") }}'
  - &period_year_month
    name: period_year_month
    description: '{{ doc("ntd_period_year_month") }}'
  - &_dt
    name: _dt
    description: '{{ doc("ntd_xlsx_dt") }}'
  - &execution_ts
    name: execution_ts
    description: '{{ doc("ntd_xlsx_execution_ts") }}'

models:
  - name: dim_annual_agency_information
    description: >
      Contains basic contact and agency information for each NTD reporter.

      The dataset can be found at:
        https://www.transit.dot.gov/ntd/data-product/2023-annual-database-agency-information
        * For other years, just replace 2023 by the desired year.

      The versioning is bitemporal, so records are versioned at the year, ntd_id, and state_parent_ntd_id level.
      This means you must join based on _valid_from/_valid_from to get the records for a given ntd_id and state_parent_ntd_id,
      and then choose which year to look up.

      Use _is_current to find the latest version for each set of year, ntd_id, and state_parent_ntd_id.
    tests:
      - dbt_utils.mutually_exclusive_ranges:
          lower_bound_column: _valid_from
          upper_bound_column: _valid_to
          partition_by: CONCAT(year, '_', ntd_id, '_', COALESCE(state_parent_ntd_id, ''))
          gaps: required
    columns:
      - name: key
        tests:
          - not_null
          - unique
      - <<: *report_year
        name: year
        tests:
          - not_null
      - <<: *ntd_id
        tests:
          - not_null
      - name: _valid_from
        tests:
          - not_null
      - name: _valid_to
        tests:
          - not_null
      - name: _is_current
        description: Indicates the latest report version for each year, ntd_id, and state_parent_ntd_id.
        tests:
          - not_null
      - name: state_parent_ntd_id
        description: |
          Indicates the ID number of the transit agency reporting to the database on behalf of the transit agency.
      - name: agency_name
        description: |
          The agency name is the full legal name of the agency.
          If reporting is required under an FTA grant program, this must reflect the legal name of the funding recipient.
      - name: doing_business_as
        description: The name under which the reporting agency is doing business.
      - name: address_line_1
        description: First line of the agency's mailing address.
      - name: address_line_2
        description: Second line of the agency's mailing address (if applicable).
      - name: p_o__box
        description: The PO Box of the agency (if applicable).
      - name: city
        description: City of the agency's mailing address.
      - name: state
        description: State of the agency's mailing address.
      - name: zip_code
        description: Zip Code of the agency's mailing address.
      - name: zip_code_ext
        description: Zip Code Extension of the agency's mailing address.
      - name: region
        description: The FTA region in which the reporter is located.
      - name: density
        description: The population density of the Primary UZA of the agency, if one exists.
      - name: ueid
        description: |
          The UEID is a number or other identifier used to identify a specific commercial, nonprofit, or Government entity.
          This is now reported in place of DUNS number for each unique transit agency reporting to the NTD.
          See the U.S. General Services Administration UEID web page for more information.
      - name: fta_recipient_id
        description: |
          The four-digit number assigned to a transit agency for the Federal Transit Administration (FTA) electronic grant making system — TrAMS (Transportation Award Management System).
      - name: original_due_date
        description: The date on which the 2020 NTD Report was due to FTA.
      - name: fy_end_date
        description: Calendar selection for the last day of an agency's fiscal year.
      - name: number_of_counties_with_service
        description: |
          States report the total number of counties in the state that are currently served, in whole or in part, by Formula Grants for Rural Areas (§5311)-funded operators.
      - name: number_of_state_counties
        description: The number of Counties in given State (for State Departments of Transportation).
      - *organization_type
      - name: personal_vehicles
        description: |
          Vehicles that are used by the transit provider to transport passengers in revenue service but are owned by private individuals, typically an employee of the agency or a volunteer driver.
      - name: population
        description: The population of the Primary UZA of the agency, if one exists.
      - *primary_uza_code
      - *primary_uza_name
      - name: reported_by_name
        description: The NTD ID of the entity reporting on behalf of another entity.
      - name: reported_by_ntd_id
        description: |
          The entity, usually a State, submitting an NTD report on behalf of another entity, usually a subrecipient of the State.
      - name: reporter_acronym
        description: The acronym used by the reporting agency.
      - name: reporter_type
        description: |
          Reporter Type will be based on where they operate and the reporting requirements associated with their agency.
          Agencies that receive Chapter 53 funds and own, operate, or manage capital assets in public transportation are also required to file an annual report, even if they do not receive §5307 or §5311 funds.
          Agencies that do not receive or benefit from FTA funding may elect to submit their data to the NTD as Voluntary Reporter but are still assigned a reporter type.
          Current types are:
            `Building Reporter`,
            `Full Reporter`,
            `Group Plan Sponsor`,
            `Planning Reporter`,
            `Reduced Asset Reporter`,
            `Reduced Reporter`,
            `Rural Reporter`,
            `Separate Service`,
            `State Reporter`.
      - name: reporting_module
        description: |
          A general classification that will determine which, if any, FTA formula programs will use the NTD data.
          For example, Tribes and Native Villages will have data included in the in the §5311j Tribal Transit Program.
          Reporters receiving Chapter 53 funds but not receiving or benefiting from §5307 and §5311
          AND not electing to report service data are classified as Asset due to the requirement to report asset inventory data.
          These agencies are not presently included in formula program datasets.
      - name: service_area_pop
        description: |
          A measure of access to transit service in terms of population served and area coverage (square miles).
          The reporting transit agency determines the service area boundaries and population for most transit services using the definitions contained in the Americans with Disabilities Act of 1990 (ADA),
          i.e. a corridor surrounding the routes 3/4 of a mile on either side, or for rail, a series of circles of radius 3/4 mile centered on each station Transit agency reporters are required to submit service area information.
      - name: sq_miles
        description: The square miles of the Primary UZA of the agency, if one exists.
      - *service_area_sq_miles
      - name: state_admin_funds_expended
        description: |
          States report the §5311 revenues they expended as a result of administering the program.
          Since the §5311 program operates on a reimbursement basis, revenues expended during the report year will be expended during the same year.
          Report the operating revenue expended during the report year from FTA §5311 Formula Grants for Rural Areas funds.
      - name: subrecipient_type
        description: Reflects the type of Rural Formula Grant funding received by the subrecipient.
      - name: tam_tier
        description: |
          Defines whether the agency is a Tier I agency required to produce their own Transit Asset Management plan (and, in parenparens, on what basis)
          or a Tier II operator eligible to be in a group TAM Plan.
          N/A indicates that the requirement does not apply.
      - name: total_voms
        description: |
          The Vehicles Operated in Maximum Service ("peak service level") across the entire fiscal year for the given agency.
      - name: tribal_area_name
        description: The tribal land, determined by US Census data, on which tribes operate.
      - name: url
        description: Agency's transit website.
      - name: volunteer_drivers
        description: |
          Individuals who drive vehicles in revenue service to transport passengers for the transit provider but are not employees of the transit provider and are not compensated for their labor.

  - name: dim_annual_funding_sources
    description: >-
      This dataset details federal, state, and local funding sources for each applicable agency reporting to the NTD.
      Federal funding sources are financial assistance obtained from the Federal Government to assist with the costs of providing transit services.
      NTD Data Tables organize and summarize data from the National Transit Database in a manner that is more useful for quick reference and summary analysis.
      This dataset is based on the Revenue Sources database file.
    columns:
      - name: funding_source
        description: |
          The table that originated the funding source information.
          The options are: "federal", "state", and "local".
        tests:
          - accepted_values:
              values: ["federal", "state", "local"]
      - *agency
      - *agency_voms
      - *city
      - name: fuel_tax
        description: |
          Revenue from taxing fuel.
          *ONLY for Local Funding Sources (funding_source = "local")
      - name: fta_capital_program_5309
        description: |
          The Capital Program provided capital assistance for three primary activities:
          - New and replacement buses and facilities,
          - Modernization of existing fixed guideway (FG) systems,
          - New fixed FG systems In MAP-21.
          The Capital Program was split into three separate programs.
          The State of Good Repair program is one of these successor programs.
          The other two are the Bus and Bus Facilities (5339) program and the Fixed Guideway Capital Investment (5309) program.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: fta_rural_progam_5311
        description: |
          This program provides formula funding to States and Indian Tribes for supporting public transportation in areas with a population of less than 50,000.
          Funding may be used for capital, operating, State administration, and project administration expenses.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: fta_urbanized_area_formula
        description: |
          The Urbanized Area Formula Funding program (49 U.S.C. 5307) provides Federal resources to urbanized areas for transit capital and operating assistance and for transit related planning.
          The Bus and Bus Facilities program is a formula program that finances capital projects to replace, rehabilitate, and purchase buses and related equipment and to construct bus-related facilities.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: general_funds
        description: |
          Any funds allocated to transit out of the general revenues of the local or state government.
          General revenue funds are usually granted through a state or local government’s annual budgeting process.
          *ONLY for Local and State Funding Sources (funding_source IN ("local", "state"))
      - name: income_tax
        description: |
          Revenue from taxing income.
          *ONLY for Local Funding Sources (funding_source = "local")
      - *ntd_id
      - *organization_type
      - name: other_dot_funds
        description: |
          Funding from grants provided by divisions of the federal Department of Transportation other than FTA.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: other_federal_funds
        description: |
          Funding from departments of the federal government other than Transportation.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: other_fta_funds
        description: |
          Funding from FTA grants other than the ones already listed (5307, 5339, 5309, 5337, 5311).
          May include:
          - 5303 Metropolitan Planning,
          - 5308 Clean Fuels,
          - 5310 Special Needs/ADA,
          - 5316 Job Access and Reverse Commute,
          - 5317 New Freedom,
          - 5320 Transit in the Park.
          *ONLY for Federal Funding Sources (funding_source = "federal")
      - name: other_funds
        description: |
          Revenue from funds imposed on the public other than taxes, such as:
          - Vehicle licensing and registration fees,
          - Lottery and casino proceeds,
          - Sale of property and assets.
          *ONLY for Local Funding Sources (funding_source = "local")
      - name: other_taxes
        description: |
          Revenues generated from a charge imposed by the state or local government, or independent political entity (e.g., transit authority) on persons or property to help pay expenses, including:
          - Payroll taxes,
          - Utility taxes,
          - Communication taxes (e.g., telephone taxes),
          - Motor vehicle and tire excise taxes.
          But excluding:
          - Income taxes,
          - Property taxes,
          - Sales taxes,
          - Fuel taxes.
          *ONLY for Local Funding Sources (funding_source = "local")
      - *primary_uza_population
      - name: property_tax
        description: |
          Revenue from taxing property.
          *ONLY for Local Funding Sources (funding_source = "local")
      - name: reduced_reporter_funds
        description: |
          Local and State funding sources reported by agencies that do not report funding sources in specific categories because they have reduced reporting requirements.
          *ONLY for Local and State Funding Sources (funding_source IN ("local", "state"))
      - <<: *report_year
        tests:
          - accepted_values:
              values: [2022, 2023]
      - *reporter_type
      - name: sales_tax
        description: |
          Revenue from taxing sales.
          *ONLY for Local Funding Sources (funding_source = "local")
      - *state
      - name: tolls
        description: |
          Revenue from tolls on bridges, highways, and high occupancy/toll lanes.
          *ONLY for Local Funding Sources (funding_source = "local")
      - name: transportation_funds
        description: |
          *ONLY for State Funding Sources (funding_source = "state")
      - *primary_uza_code
      - *primary_uza_name

  - name: dim_annual_service_agencies
    description: >-
      Provides transit agency-wide totals for service data for applicable agencies reporting to the National Transit Database.
      This view displays the data at a higher level (by agency), based on the "NTD Annual Data - Service (by Mode and Time Period)" dataset.
      In the years 2015-2021, you can find this data in the "Service" data table on NTD Program website, at https://transit.dot.gov/ntd/ntd-data.
      In versions of the data tables from before 2014, you can find data on service in the file called "Transit Operating Statistics: Service Supplied and Consumed."
    columns:
      - name: key
        tests:
          - not_null
          - unique
      - <<: *report_year
        tests:
          - accepted_values:
              values: [2022, 2023]
      - *ntd_id
      - *agency
      - *reporter_type
      - *organization_type
      - *city
      - *state
      - *agency_voms
      - *primary_uza_code
      - *primary_uza_name
      - *primary_uza_area_sq_miles
      - *primary_uza_population
      - *service_area_sq_miles
      - *service_area_population
      - name: actual_vehicles_passenger_car_deadhead_hours
        description: |
          The hours that a vehicle/passenger car travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - <<: *actual_vehicle_hours
        name: actual_vehicles_passenger_car_hours
      - name: actual_vehicles_passenger_car_miles
        description: |
          The miles that vehicles/passenger cars travel while in revenue service (actual vehicle revenue miles (VRM)) plus deadhead miles.
          Actual vehicle miles include:
            - Revenue service,
            - Deadhead.
          Actual vehicle miles exclude:
            - Miles for charter services,
            - School bus service,
            - Operator training,
            - Vehicle maintenance testing.
      - name: actual_vehicles_passenger_car_revenue_hours
        description: |
          The hours that vehicles/passenger cars travel while in revenue service.
          Vehicle revenue hours (VRH) include:
            - Revenue service,
            - Layover/recovery time.
          Actual vehicle revenue hours exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - School bus and charter services.
      - name: actual_vehicles_passenger_car_revenue_miles
        description: |
          The miles that vehicles/passenger cars travel while in revenue service.
          Vehicle revenue miles (VRM) include:
            - Revenue service.
          Actual vehicle revenue miles exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - School bus and charter services.
      - name: actual_vehicles_passenger_deadhead_miles
        description: |
          The miles that a vehicle/passenger car travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - name: scheduled_vehicles_passenger_car_revenue_miles
        description: |
          The total service scheduled to be provided for picking up and discharging passengers.
          Scheduled service is computed from internal transit agency planning documents (e.g., run paddles, trip tickets, and public timetables).
          Scheduled service excludes special additional services.
      - name: charter_service_hours
        description: Hours run in charter service.
      - name: school_bus_hours
        description: Hours run in school bus service.
      - name: trains_in_operation
        description: The maximum number of trains actually operated to provide service during the year.
      - name: directional_route_miles
        description: |
          The mileage in each direction over which public transportation vehicles travel while in revenue service.
          Directional route miles (DRM) are:
          - A measure of the route path over a facility or roadway, not the service carried on the facility; e.g., number of routes, vehicles, or vehicle revenue miles.
          - Computed with regard to direction of service, but without regard to the number of traffic lanes or rail tracks existing in the right-of-way (ROW).
          Directional route miles (DRM) do not include staging or storage areas at the beginning or end of a route.
      - name: passenger_miles
        description: The cumulative sum of the distances ridden by each passenger.
      - name: train_miles
        description: |
          The miles that trains travel while in revenue service (actual vehicle revenue miles (VRM)) plus deadhead miles.
          Train miles include:
            - Revenue service,
            - Deadhead.
          Train miles exclude:
            - Miles for charter services,
            - Operator training,
            - Vehicle maintenance testing.
      - name: train_revenue_miles
        description: |
          The miles that trains travel while in revenue service.
          Train revenue miles include:
            - Revenue service.
          Train revenue miles exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - Charter services.
      - name: train_deadhead_miles
        description: |
          The miles that a train travels when out of revenue service. Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - name: train_hours
        description: |
          The hours that trains travel while in revenue service plus deadhead hours.
          Train hours include:
            - Revenue service,
            - Deadhead,
            - Layover/recovery time,
          Train hours exclude:
            - Hours for charter service,
            - Operator training,
            - Vehicle maintenance testing.
      - name: train_revenue_hours
        description: |
          The hours that trains travel while in revenue service. Train revenue hours include:
            - Revenue service,
            - Layover/recovery time.
          Train revenue hours exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - Charter services.
      - name: train_deadhead_hours
        description: |
          The hours that a train travels when out of revenue service. Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - name: ada_upt
        description: Unlinked Passenger Trips embarked per stipulations of the Americans with Disabilities Act.
      - name: sponsored_service_upt
        description: Unlinked Passenger Trips embarked under sponsored service.
      - name: unlinked_passenger_trips_upt
        description: |
          The number of passengers who board public transportation vehicles.
          Passengers are counted each time they board a vehicle no matter how many vehicles they use to travel from their origin to their destination.

  - name: dim_annual_service_mode_time_periods
    description:
      This represents the Service data reported to the NTD by transit agencies.
    columns:
      - name: key
        tests:
          - not_null
          - unique
      - <<: *report_year
        tests:
          - accepted_values:
              values: [2022, 2023]
      - *reporter_type
      - *ntd_id
      - *agency
      - *type_of_service
      - *mode
      - *mode_name
      - <<: *time_period
        tests:
          - accepted_values:
              values: ["Average Weekday - AM Peak", "Average Weekday - Midday", "Average Weekday - PM Peak", "Average Weekday - Other", "Average Typical Weekday", "Average Typical Saturday", "Average Typical Sunday"]
      - name: time_service_begins
        description: The time at which a particular mode/type of service begins revenue service, presented in a 24-hour format.
      - name: time_service_ends
        description: The time at which a particular mode/type of service ends revenue service, presented in a 24-hour format.
      - *organization_type
      - *city
      - *state
      - *primary_uza_code
      - *primary_uza_name
      - *primary_uza_area_sq_miles
      - *primary_uza_population
      - *service_area_population
      - *service_area_sq_miles
      - name: days_of_service_operated
        description: Days of revenue service within the fiscal year.
      - name: days_not_operated_strikes
        description: Days of revenue service not operated due to strikes.
      - name: days_not_operated_emergencies
        description: Days of revenue service not operated due to emergencies.
      - *agency_voms
      - name: mode_voms
        description: |
          The number of revenue vehicles operated by the given mode and type of service to meet the annual maximum service requirement.
          This is the revenue vehicle count during the peak season of the year; on the week and day that maximum service is provided.
          Vehicles operated in maximum service (VOMS) exclude atypical days and one-time special events.
      - <<: *questionable_data
        name: mode_voms_questionable
      - name: actual_vehicles_passenger_car_miles
        description: |
          The miles that vehicles/passenger cars travel while in revenue service (actual vehicle revenue miles (VRM)) plus deadhead miles.
          Actual vehicle miles include:
            - Revenue service,
            - Deadhead.
          Actual vehicle miles exclude:
            - Miles for charter services,
            - School bus service,
            - Operator training,
            - Vehicle maintenance testing.
      - <<: *questionable_data
        name: vehicle_miles_questionable
      - name: actual_vehicles_passenger_car_revenue_miles
        description: |
          The miles that vehicles/passenger cars travel while in revenue service.
          Vehicle revenue miles (VRM) include:
            - Revenue service.
          Actual vehicle revenue miles exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - School bus and charter services.
      - <<: *questionable_data
        name: vehicle_revenue_miles_questionable
      - name: actual_vehicles_passenger_deadhead_miles
        description: |
          The miles that a vehicle/passenger car travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - <<: *questionable_data
        name: deadhead_miles_questionable
      - name: scheduled_vehicles_passenger_car_revenue_miles
        description: |
          The total service scheduled to be provided for picking up and discharging passengers.
          Scheduled service is computed from internal transit agency planning documents (e.g., run paddles, trip tickets, and public timetables).
          Scheduled service excludes special additional services.
      - <<: *questionable_data
        name: scheduled_revenue_miles_questionable
      - <<: *actual_vehicle_hours
        name: actual_vehicles_passenger_car_hours
      - <<: *questionable_data
        name: vehicle_hours_questionable
      - name: actual_vehicles_passenger_car_revenue_hours
        description: |
          The hours that vehicles/passenger cars travel while in revenue service.
          Vehicle revenue hours (VRH) include:
            - Revenue service,
            - Layover/recovery time.
          Actual vehicle revenue hours exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - School bus and charter services.
      - <<: *questionable_data
        name: vehicle_revenue_hours_questionable
      - name: actual_vehicles_passenger_car_deadhead_hours
        description: |
          The hours that a vehicle/passenger car travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - <<: *questionable_data
        name: deadhead_hours_questionable
      - name: charter_service_hours
        description: Hours run in charter service.
      - name: school_bus_hours
        description: Hours run in school bus service.
      - name: trains_in_operation
        description: The maximum number of trains actually operated to provide service during the year.
      - <<: *questionable_data
        name: trains_in_operation_questionable
      - name: train_miles
        description: |
          The miles that trains travel while in revenue service (actual vehicle revenue miles (VRM)) plus deadhead miles.
          Train miles include:
            - Revenue service,
            - Deadhead.
          Train miles exclude:
            - Miles for charter services,
            - Operator training,
            - Vehicle maintenance testing.
      - <<: *questionable_data
        name: train_miles_questionable
      - name: train_revenue_miles
        description: |
          The miles that trains travel while in revenue service.
          Train revenue miles include:
            - Revenue service.
          Train revenue miles exclude:
            - Deadhead,
            - Operator training,
            - Maintenance testing,
            - Charter services.
      - <<: *questionable_data
        name: train_revenue_miles_questionable
      - name: train_deadhead_miles
        description: |
          The miles that a train travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - name: train_hours
        description: |
          The hours that trains travel while in revenue service plus deadhead hours.
          Train hours include:
            - Revenue service,
            - Deadhead,
            - Layover/recovery time.
          Train hours exclude:
            - Hours for charter service,
            - Operator training,
            - Vehicle maintenance testing.
      - <<: *questionable_data
        name: train_hours_questionable
      - name: train_revenue_hours
        description: |
          The hours that trains travel while in revenue service.
          Train revenue hours include:
            - Revenue service,
            - Layover/recovery time.
          Train revenue hours exclude:
            - Deadhead,
            - Operator training ,
            - Maintenance testing,
            - Charter services.
      - <<: *questionable_data
        name: train_revenue_hours_questionable
      - name: train_deadhead_hours
        description: |
          The hours that a train travels when out of revenue service.
          Deadhead includes:
            - Leaving or returning to the garage or yard facility,
            - Changing routes,
            - When there is no expectation of carrying revenue passengers.
          However, deadhead does not include:
            - Charter service,
            - School bus service,
            - Travel to fueling facilities,
            - Travel to maintenance facilities,
            - Operator training,
            - Maintenance testing.
      - name: unlinked_passenger_trips_upt
        description: |
          The number of passengers who board public transportation vehicles.
          Passengers are counted each time they board a vehicle no matter how many vehicles they use to travel from their origin to their destination.
      - name: unlinked_passenger_trips_questionable
        description: |
          FTA marks a data point as Questionable when there is reason to believe it is incorrect,
          but the reporting agency has been unable to correct the data or offer an explanation for its anomalous appearance.
      - name: ada_upt
        description: Unlinked Passenger Trips embarked per stipulations of the Americans with Disabilities Act.
      - name: sponsored_service_upt
        description: Unlinked Passenger Trips embarked under sponsored service.
      - name: average_passenger_trip_length_aptl_
        description: |
          The average distance ridden by each passenger in a single trip, computed as passenger miles traveled (PMT) divided by unlinked passenger trips (UPT).
          May be determined by sampling, or calculated based on actual data.
      - <<: *questionable_data
        name: aptl_questionable
      - name: average_speed
        description: The average speed of a vehicle/passenger car during revenue service.
      - <<: *questionable_data
        name: average_speed_questionable
      - name: brt_non_statutory_mixed_traffic
        description: |
          Miles of roadway for Bus Rapid Transit modes which, while part of bus rapid transit system routes, are not considered fixed guideway for federal funding allocation purposes.
          These are rare exceptions resulting from FTA’s review of each BRT system.
      - name: mixed_traffic_right_of_way
        description: |
          Roadways other than exclusive and controlled access rights-of-way (ROW) used for transit operations that are mixed with pedestrian and/or vehicle traffic.
          Does not include guideways that have only grade crossings with vehicular traffic.
      - name: directional_route_miles
        description: |
          The mileage in each direction over which public transportation vehicles travel while in revenue service.
          Directional route miles (DRM) are:
            - A measure of the route path over a facility or roadway, not the service carried on the facility; e.g., number of routes, vehicles, or vehicle revenue miles.
            - Computed with regard to direction of service, but without regard to the number of traffic lanes or rail tracks existing in the right-of-way (ROW).
          Directional route miles (DRM) do not include staging or storage areas at the beginning or end of a route.
      - <<: *questionable_data
        name: directional_route_miles_questionable
      - name: passenger_miles
        description: The cumulative sum of the distances ridden by each passenger.
      - <<: *questionable_data
        name: passenger_miles_questionable
      - name: passengers_per_hour
        description: |
          The average number of passengers to board a vehicle/passenger car in one hour of service.
          For trains, this applies to passengers per hour on a single train car.
      - <<: *questionable_data
        name: passengers_per_hour_questionable

  - name: dim_monthly_ridership_with_adjustments
    description: >-
      Extracts of the NTD Complete Monthly Ridership with Adjustments and Estimates (UPT, VOMS, VRH, and VRM)
      that contains all monthly module data reported to the NTD since January 2002.
      Mode and Type of Service Changes and Impacts on this Time Series

      Monthly data are reported by mode and type of service.
      From 2002 through 2011, there were 16 modes in the NTD.
      NTD monthly ridership data is now reported according to refined modal classifications.
      Service previously reported as bus (MB) now may be reported as either MB, Commuter Bus (CB),
      or Bus Rapid Transit (RB).
      Additionally, service previously categorized as Light Rail (LR) now may be reported as LR or
      Streetcar (SR).

      Similarly, Types of Service were refined in Report Year 2019.
      From 2002 - 2018, there were two types of service:
        Directly Operated (DO) and
        Purchased Transportation (PT).

      As of 2019, Purchased Transportation is now classified such that agencies report the
      purchased transportation based on the type of contractor:
        general third party (PT),
        taxicab operator (TX),
        or transportation network company (TN).

      FTA concurrently removed the "Demand Response Taxi" (DT/PT) mode in 2019.
      FTA now considers all such service as Demand Response (DR) with Taxi (TX) type of service and
      this time series has been updated to reflect this change.

      This time series also considers modes which have been combined, collapsing the
      Automated Guideway (AG) and Monorail (MO) mode historical data into the
      Monorail/Automated Guideway (MG) mode to reflect the current reporting arrangement and
      allow for easier analysis of these modes.

      Finally, FTA introduced the Hybrid Rail (YR) mode in January 2012. While this mode combines
      some systems previously classified as either Commuter Rail (CR) or Light Rail (LR),
      this change could not be done uniformly; most operators of Hybrid Rail continued to
      offer services presently defined as CR or LR.
      Therefore, this time series does not attempt to combine historically.
      Data users should therefore take caution that the following systems converted completely
      from Commuter Rail to Hybrid Rail around this time:
      - 60048 Capital Metropolitan Transportation Authority (Commuter Rail to Hybrid Rail)
      - 60101 Denton County Transportation Authority (Commuter Rail to Hybrid Rail)
      - 90030 North County Transit District (Light Rail to Hybrid Rail)

      The dataset is found at:
        https://www.transit.dot.gov/ntd/data-product/monthly-module-adjusted-data-release.

      For more information use the glossary of transit terms located at:
        https://www.transit.dot.gov/ntd/national-transit-database-ntd-glossary
      or the reporting manuals located at:
        https://www.transit.dot.gov/ntd/manuals.

    columns:
      - name: key
        tests:
          - not_null
          - unique
      - *_dt
      - *execution_ts
      - *period_year_month
      - *period_month
      - *period_year
      - <<: *ntd_id
        tests:
          - not_null
      - *reporter_type
      - *agency
      - *mode_type_of_service_status
      - *mode
      - *mode_name
      - *_3_mode
      - *service_type
      - <<: *type_of_service
        name: tos
      - *legacy_ntd_id
      - *primary_uza_name
      - *primary_uza_code
      - *upt
      - *voms
      - *vrh
      - *vrm

  - name: fct_annual_service_modes
    description:
      View based on NTD Annual Data - Service (by Mode and Time Period)
      View of Service by Mode and Time Period filtered to preserve only the Annual Total time period.
      Useful for analyses of Annual Total service data.
    columns:
      - name: key
        tests:
          - not_null
          - unique
      - <<: *report_year
        tests:
          - accepted_values:
              values: [2022, 2023]
      - *ntd_id
      - *type_of_service
      - *mode
      - *mode_name
      - <<: *questionable_data
        name: questionable_record
      - <<: *time_period
        description: |
          The time period for which data was collected.
          This table displays only "Annual Total".
        tests:
          - accepted_values:
              values: ["Annual Total"]
