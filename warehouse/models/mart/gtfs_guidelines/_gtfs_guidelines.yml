version: 2

models:
  - name: fact_daily_guideline_checks
    description: '{{ doc("guideline_checks") }}'
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - date
            - calitp_itp_id
            - calitp_url_number
            - check
      - dbt_utils.equal_rowcount:
          compare_model: ref('stg_gtfs_guidelines__feed_guideline_index')
    columns:
      - name: date
        description: Date on which the check is being evaluated.
      - name: calitp_itp_id
        description: '{{ doc("column_calitp_itp_id") }}'
        meta:
          metabase.semantic_type: type/FK
      - name: calitp_url_number
        description: '{{ doc("column_calitp_url_number") }}'
        meta:
          metabase.semantic_type: type/FK
      - name: calitp_agency_name
        description: Human readable agency name, provided for convenience.
        meta:
          metabase.semantic_type: type/Title
      - name: check
        description: |
          A string description of the GTFS guideline check being performed. For example,
          "Static GTFS feed downloads successfully".
      - name: status
        description: |
          Either "PASS" or "FAIL", indicating check status on the given date for the
          given feed.
        tests:
          - not_null
      - name: feature
        description: |
          A string label for the GTFS "feature" associated with the given check. For example,
          "Compliant / On the Map".

  - name: fact_daily_transitland_url_check
    description: '{{ doc("transitland_url_check_table") }}'
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - dt
            - url_type
            - calitp_itp_id
            - calitp_url_number
    columns:
      - name: dt
      - name: url
      - name: url_type
      - name: calitp_itp_id
        description: '{{ doc("column_calitp_itp_id") }}'
      - name: calitp_url_number
        description: '{{ doc("column_calitp_url_number") }}'
      - name: transitland_status
        description: A value of either `present` or `missing`
      - name: transitland_public_web_url
