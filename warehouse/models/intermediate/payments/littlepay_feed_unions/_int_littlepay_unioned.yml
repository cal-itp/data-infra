version: 2

models:
  - name: int_littlepay__unioned_authorisations
  - name: int_littlepay__unioned_customer_funding_source
  - name: int_littlepay__unioned_device_transaction_purchases
  - name: int_littlepay__unioned_device_transactions
  - name: int_littlepay__unioned_micropayment_adjustments
  - name: int_littlepay__unioned_micropayment_device_transactions
  - name: int_littlepay__unioned_micropayments
  - name: int_littlepay__unioned_product_data
  - name: int_littlepay__unioned_refunds
  - name: int_littlepay__unioned_settlements
    description: >
      Settlements records from v3 and prior data feed versions unioned together into a single table.
    columns:
      - name: settlement_id
        description: '{{ doc("lp_settlement_id") }}'
      - name: participant_id
        description: '{{ doc("lp_participant_id") }}'
      - name: aggregation_id
        description: '{{ doc("lp_aggregation_id") }}'
      - name: customer_id
        description: '{{ doc("lp_customer_id") }}'
      - name: funding_source_id
        description: '{{ doc("lp_funding_source_id") }}'
      - name: settlement_type
        description: '{{ doc("lp_settlement_type") }}'
      - name: transaction_amount
        description: '{{ doc("lp_transaction_amount") }}'
      - name: retrieval_reference_number
        description: '{{ doc("lp_retrieval_reference_number") }}'
      - name: littlepay_reference_number
        description: '{{ doc("lp_littlepay_reference_number") }}'
      - name: external_reference_number
        description: '{{ doc("lp_external_reference_number") }}'
      - name: record_updated_timestamp_utc
        description: '{{ doc("lp_record_updated_timestamp_utc") }}'
      - name: acquirer
        description: '{{ doc("lp_acquirer") }}'
      - name: acquirer_response_rrn
        description: '{{ doc("lp_acquirer_response_rrn") }}'
      - name: settlement_status
        description: '{{ doc("lp_settlement_status") }}'
      - name: request_created_timestamp_utc
        description: '{{ doc("lp_request_created_timestamp_utc") }}'
      - name: response_created_timestamp_utc
        description: '{{ doc("lp_response_created_timestamp_utc") }}'
      - name: refund_id
        description: '{{ doc("lp_refund_id") }}'
      - name: littlepay_export_date
        description: |
          Date of the source file from Littlepay. Date is extracted from filenames, which generally have the
          structure {timestamp}_{data_type}.{file extension}.
      - name: littlepay_export_ts
        description: |
          Timestamp of the source file from Littlepay. Timestamp is extracted from filenames, which generally have the
          structure {timestamp}_{data_type}.{file extension}.
      - name: _line_number
        description: |
          Line number of this row in the source file.
          Some line numbers may be missing because we drop extra copies of rows that are full duplicates of another row.
      - name: _key
        description: |
          Synthetic key composed of Littlepay file date and line number to uniquely identify a row within source data.
      - name: _payments_key
        description: |
          Synthentic key composed of the elements that define a natural key within the source data (primary key according to Littlepay schema.)
      - name: _content_hash
        description: |
          Hash of all data columns to uniquely identify row's content, mostly for debugging purposes.
          Should ideally be handled by uniqueness of _payments_key but surfaced for troubleshooting.
      - name: feed_version
        description: '{{ doc("lp_feed_version") }}'
      - name: instance
        description: '{{ doc("lp_instance") }}'
      - name: extract_filename
        description: '{{ doc("lp_extract_filename") }}'
      - name: ts
        description: '{{ doc("lp_ts") }}'
