WITH
  source AS (
      SELECT *
        FROM {{ source('external_ntd__ridership', 'historical__complete_monthly_ridership_with_adjustments_and_estimates__voms') }}
        WHERE ntd_id IS NOT NULL
        -- Removing records without NTD_ID because contains "estimated monthly industry totals for Rural reporters" from the bottom of the scraped file
  ),

  stg_ntd__complete_monthly_ridership_with_adjustments_and_estimates__voms AS(
      SELECT *
        FROM source
      -- we pull the whole table every month in the pipeline, so this gets only the latest extract
      QUALIFY DENSE_RANK() OVER (ORDER BY execution_ts DESC) = 1
  )

SELECT
  _12_2024,
  _9_2024,
  _8_2024,
  _6_2024,
  _3_2024,
  _2_2024,
  _1_2024,
  _10_2023,
  _6_2023,
  _4_2023,
  _8_2023,
  _3_2023,
  _1_2023,
  _12_2022,
  _11_2022,
  _9_2022,
  _5_2022,
  _11_2021,
  _10_2021,
  _8_2021,
  _5_2021,
  _4_2021,
  _11_2023,
  _2_2021,
  _11_2020,
  _7_2020,
  _6_2020,
  _1_2020,
  _10_2019,
  _8_2019,
  _6_2021,
  _7_2019,
  _6_2019,
  _7_2021,
  _3_2019,
  _11_2018,
  _10_2018,
  _9_2018,
  _7_2018,
  _12_2019,
  _6_2018,
  _4_2018,
  _1_2018,
  _12_2017,
  _11_2017,
  _8_2017,
  _5_2012,
  _6_2017,
  _5_2017,
  _2_2017,
  _7_2022,
  _1_2017,
  _10_2016,
  _5_2019,
  _3_2010,
  _7_2017,
  _12_2010,
  _9_2016,
  _12_2018,
  _9_2017,
  _8_2016,
  _4_2016,
  _12_2016,
  _3_2016,
  _3_2021,
  _10_2015,
  _12_2021,
  _7_2015,
  _8_2010,
  _3_2015,
  _11_2002,
  _12_2014,
  _9_2015,
  _3_2018,
  _7_2004,
  _11_2014,
  _7_2014,
  _3_2014,
  _4_2015,
  _10_2013,
  _9_2023,
  _1_2010,
  _4_2008,
  _9_2013,
  _12_2020,
  _7_2013,
  _6_2013,
  _1_2007,
  _5_2013,
  _6_2004,
  _3_2013,
  _3_2020,
  _3_2005,
  _1_2014,
  _10_2006,
  _1_2013,
  _6_2007,
  _3_2017,
  _12_2012,
  _2_2013,
  _2_2022,
  _11_2012,
  _10_2012,
  _9_2012,
  _8_2012,
  _6_2012,
  _4_2012,
  _12_2015,
  _3_2004,
  _10_2014,
  _2_2012,
  _2_2014,
  _12_2011,
  _3_2012,
  _3_2011,
  _5_2024,
  _10_2017,
  _11_2013,
  _10_2020,
  _5_2020,
  legacy_ntd_id,
  _1_2011,
  _11_2010,
  _9_2021,
  _10_2010,
  _4_2017,
  _6_2011,
  _7_2010,
  _5_2010,
  _4_2010,
  _7_2023,
  _2_2010,
  _4_2022,
  _12_2009,
  _11_2009,
  _10_2009,
  _1_2022,
  _8_2009,
  _7_2009,
  _11_2011,
  _9_2002,
  _6_2009,
  _6_2022,
  _4_2009,
  _4_2020,
  _2_2009,
  _11_2016,
  _1_2021,
  _5_2015,
  _2_2005,
  _12_2008,
  _4_2019,
  _10_2008,
  _12_2023,
  _9_2009,
  _8_2015,
  _8_2008,
  _3_2009,
  _11_2015,
  _10_2002,
  _9_2020,
  _3_2007,
  _7_2008,
  _3_2008,
  _10_2007,
  tos,
  _7_2024,
  _8_2007,
  _9_2014,
  _2_2023,
  _6_2003,
  _7_2007,
  _4_2007,
  _2_2016,
  _2_2004,
  _2_2008,
  _12_2003,
  _7_2011,
  _2_2007,
  _5_2018,
  _5_2002,
  _12_2006,
  _11_2006,
  _8_2006,
  _5_2014,
  _11_2003,
  _9_2006,
  _7_2006,
  _5_2006,
  _12_2005,
  _1_2016,
  _12_2007,
  _4_2005,
  _4_2006,
  _3_2003,
  _2_2006,
  _8_2011,
  _9_2005,
  _11_2019,
  _1_2006,
  _6_2014,
  _2_2019,
  _12_2013,
  _1_2008,
  _12_2002,
  _11_2024,
  _11_2005,
  _10_2005,
  _7_2005,
  _12_2004,
  _9_2010,
  _8_2005,
  _9_2008,
  _5_2011,
  _8_2004,
  _10_2004,
  _6_2016,
  _8_2020,
  _9_2007,
  _2_2011,
  _1_2003,
  _9_2004,
  _8_2018,
  agency,
  _6_2006,
  _1_2019,
  _5_2008,
  _9_2019,
  _5_2004,
  _8_2003,
  _1_2004,
  _7_2012,
  _4_2004,
  _5_2003,
  _2_2002,
  _9_2003,
  _7_2016,
  _8_2013,
  _7_2003,
  _4_2013,
  _5_2005,
  _6_2015,
  _4_2014,
  _1_2005,
  mode,
  _10_2022,
  _2_2020,
  _4_2003,
  _9_2011,
  _8_2014,
  _5_2009,
  _1_2009,
  _2_2018,
  _4_2002,
  _3_2006,
  _7_2002,
  _10_2011,
  _3_mode,
  _6_2008,
  _11_2004,
  _1_2012,
  reporter_type,
  _2_2003,
  _1_2015,
  ntd_id,
  _4_2011,
  _11_2007,
  _3_2002,
  _8_2002,
  _5_2016,
  _6_2010,
  _11_2008,
  _1_2002,
  _4_2024,
  _8_2022,
  _6_2005,
  _6_2002,
  _5_2007,
  _10_2003,
  _5_2023,
  uza_name,
  _10_2024,
  uace_cd,
  _3_2022,
  _2_2015,
  mode_type_of_service_status,
  dt,
  execution_ts
FROM stg_ntd__complete_monthly_ridership_with_adjustments_and_estimates__voms
